<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="webRTC"/>




  <meta name="keywords" content="技术阅读, lvyong" />










  <link rel="alternate" href="/default" title="lvyong" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://lvyong.github.io/2021/04/15/webRTC/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />






  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> webRTC - lvyong </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">lvyong</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags/">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/about/">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">lvyong</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          webRTC
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-04-15
        </span>
        
          <div class="post-category">
            
              <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        <p>WebRTC<br>一、发展历程<br>       名称源自网页实时通信（Web Real-Time Communication）的缩写，是一项实时通讯技术，它允许网络应用或者站点，在不借助中间媒介的情况下，建立浏览器之间点对点（Peer-to-Peer）的连接，实现视频流和（或）音频流或者其他任意数据的传输，支持网页浏览器进行实时语音对话或视频对话。WebRTC包含的这些标准使用户在无需安装任何插件或者第三方的软件的情况下，创建点对点（Peer-to-Peer）的数据分享和电话会议成为可能。它是谷歌2010年5月以6820万美元收购拥有编解码、回声消除等技术的Global IP Solutions公司而获得的一项技术。该项目是由GIPS项目和libjingle项目融合而成。其中GIPS部分主要提供媒体的处理的功能。libjingle项目部分主要提供P2P传输部分的功能。2011年5月开放了工程的源代码，与相关机构 IETF 和 W3C 制定行业标准，组成了现有的 WebRTC 项目，在行业内得到了广泛的支持和应用，成为下一代视频通话的标准。</p>
<pre><code>    ​ WebRTC是一个开源项目，旨在使得浏览器能为实时通信（RTC）提供简单的JavaScript接口。说的简单明了一点就是让浏览器提供JS的即时通信接口。这个接口所创立的信道并不是像WebSocket一样，打通一个浏览器与WebSocket服务器之间的通信，而是通过一系列的信令，建立一个浏览器与浏览器之间（peer-to-peer）的信道，这个信道可以发送任何数据，而不需要经过服务器。并且WebRTC通过实现MediaStream，通过浏览器调用设备的摄像头、话筒，使得浏览器之间可以传递音频和视频。
</code></pre>
<span id="more"></span>        

<p>二、浏览器兼容</p>
<p>   可以在浏览器打开网址： <a target="_blank" rel="noopener" href="https://html5test.com/">https://html5test.com/</a> 来测试浏览器对WebRTC的支持情况：<br>三、应用场景<br>WebRTC的点对点方式能够运用在很多场景：<br>社交平台，如视频聊天室应用<br>远程实时监控<br>远程学习，如在线教育、在线培训<br>远程医疗，如在线医疗<br>人力资源和招聘，如在线面试<br>会议和联系中心之间的协作，如客户服务、呼叫中心<br>Web IM，如web qq<br>游戏娱乐，如双人对战游戏（如象棋这种双人对战游戏，每一步的数据服务器时不关心的，所以完全可以点对点发送）<br>屏幕共享<br>人脸检测识别<br>虚拟现实<br>市场调研<br>金融服务<br>其它即时通信业务</p>
<p>四、 直播领域所用协议的现状及其优缺点比较</p>
<p>协议<br>优点<br>缺点<br>HTTP FLV<br>实时性和RTMP相等； 相比于RTMP省去了一些协议交互时间，首屏时间更短，可拓展的功能更多； 将RTMP封装在HTTP协议之上的，可以更好的穿透防火墙等<br>不支持双向互动；目前在网页上只能用flash或者插件的方式解码播放，而且flash在cpu和内存上都是占用很高。<br>RTMP<br>（实时消息传输协议）<br>CDN 支持良好，主流的 CDN 厂商都支持；协议简单，在各平台上实现容易，PC flash原生支持；支持双向互动；实时性很好；防HTTP下载。<br>基于TCP，传输成本高，在弱网环境丢包率高的情况下问题显著；不支持浏览器推送；Adobe 私有协议，Adobe已经不再更新； 需要访问1935端口，国内网络情况的恶劣程度，并不是每个网络防火墙都允许1935包通过；目前在网页上只能用flash或者插件的方式解码播放，而且flash在cpu和内存上都是占用很高。<br>HLS<br>(HTTP Live Streaming）<br>跨平台，支持度高，H5浏览器支持比较好，可以直接打开播放；IOS、安卓原生支持；技术实现简单。<br>延迟性比较大。<br>WebRTC<br>W3C 标准，主流浏览器支持程度高；Google 在背后支撑，并在各平台有参考实现；底层基于 SRTP 和 UDP，弱网情况优化空间大；可以实现点对点通信，通信双方延时低。<br>传统CDN没有ICE、STUN、TURN及类似的服务提供。</p>
<p>五、 WebRTC 的核心组件<br>音视频引擎：OPUS、VP8 / VP9、H264<br>传输层协议：底层传输协议为 UDP<br>媒体协议：SRTP / SRTCP<br>数据协议：DTLS / SCTP<br>P2P 内网穿透：STUN / TURN / ICE / Trickle ICE<br>信令与 SDP 协商：HTTP / WebSocket / SIP、 Offer Answer 模型<br>六、WebRTC架构图</p>
<p>架构图颜色标识说明：<br>（1）紫色部分是Web开发者API层；<br>（2）蓝色实线部分是面向浏览器厂商的API层（也就是红色框标内模块）;<br>（3）蓝色虚线部分浏览器厂商可以自定义实现。<br>将WebRTC架构图分解为内部结构简化图和协议栈后如下：<br>WebRTC内部结构<br>图1为 WebRTC 内部结构简化图，最底层是硬件设备，上面是音频捕获模块和视频捕获模块。中间部分为音视频引擎。音频引擎负责音频采集和传输，具有降噪、回声消除等功能。视频引擎负责网络抖动优化，互联网传输编解码优化。在音视频引擎之上是 一套 C++ API，在 C++ 的 API 之上是提供给浏览器的Javascript API。<br>图2是 WebRTC 涉及到的协议栈，WebRTC 核心的协议都是在右侧基于 UDP 基础上搭建起来的。其中：<br>ICE、STUN、TURN 用于内网穿透, 解决了获取与绑定外网映射地址，以及 keep alive 机制。DTLS 用于对传输内容进行加密，可以看做是 UDP 版的 TLS。由于 WebRTC 对安全比较重视，这一层是必须的。<br>SRTP 与 SRTCP 是对媒体数据的封装与传输控制协议。<br>SCTP 是流控制传输协议，提供类似 TCP 的特性，SCTP 可以基于 UDP 上构建，在 WebRTC 里是在 DTLS 协议之上。<br>RTCPeerConnection 用来建立和维护端到端连接，并提供高效的音视频流传输。<br>RTCDataChannel 用来支持端到端的任意二进制数据传输。<br>七、WebRTC浏览器API<br> WebRTC实现了多个Web API接口，其中三个重要的Web API分别是:<br>MediaStream：通过MediaStream的API能够通过设备的摄像头及话筒获得视频、音频的同步流。<br>RTCPeerConnection：RTCPeerConnection是WebRTC用于构建点对点之间稳定、高效的流传输的组件。<br>RTCDataChannel：RTCDataChannel使得浏览器之间（点对点）建立一个高吞吐量、低延时的信道，用于传输任意数据。<br>这里大致介绍一下这三个API<br>2. MediaStream (aka getUserMedia)<br>MediaStream API为WebRTC提供了从设备的摄像头、话筒获取视频、音频流数据的功能.<br>3. W3C标准<br>详见：<a target="_blank" rel="noopener" href="https://w3c.github.io/mediacapture-main/getusermedia.html">https://w3c.github.io/mediacapture-main/getusermedia.html</a><br>4.  如何调用？<br>可以通过navigator.getUserMedia()这个方法来调用，这个方法接受三个参数：<br>一个约束对象（constraints object），这个后面会单独讲。<br>一个调用成功的回调函数，如果调用成功，传递给它一个流对象。<br>一个调用失败的回调函数，如果调用失败，传递给它一个错误对象。</p>
<p>八、测试demo&gt;<!DOCTYPE html></p>
<html>
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GetUserMedia实例</title>
</head>
<body>
    <video id="video" autoplay></video>
</body>
<script type="text/javascript">
    var getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
    getUserMedia.call(navigator, {
        video: true,
        audio: true
    }, function(localMediaStream) {
        var video = document.getElementById('video');
        video.src = window.URL.createObjectURL(localMediaStream);
        video.onloadedmetadata = function(e) {
            console.log("Label: " + localMediaStream.label);
            console.log("AudioTracks" , localMediaStream.getAudioTracks());
            console.log("VideoTracks" , localMediaStream.getVideoTracks());
        };
    }, function(e) {
        console.log('Rejected!', e);
    });
/*  
//或：
'use strict';

<p>navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);</p>
<p>var constraints = { // 音频、视频约束<br>  audio: true, // 指定请求音频Track<br>  video: {  // 指定请求视频Track<br>      mandatory: { // 对视频Track的强制约束条件<br>          width: {min: 320},<br>          height: {min: 180}<br>      },<br>      optional: [ // 对视频Track的可选约束条件<br>          {frameRate: 30}<br>      ]<br>  }<br>};</p>
<p>function successCallback(localMediaStream) {<br>  var video = document.querySelector(‘video’);<br>  if (window.URL) {<br>    video.src = window.URL.createObjectURL(localMediaStream);<br>  } else {<br>    video.src = localMediaStream;<br>  }<br>  video.onloadedmetadata = function(e) {<br>            console.log(“Label: “ + localMediaStream.label);<br>            console.log(“AudioTracks” , localMediaStream.getAudioTracks());<br>            console.log(“VideoTracks” , localMediaStream.getVideoTracks());<br>        };<br>}</p>
<p>function errorCallback(error) {<br>  console.log(‘navigator.getUserMedia error: ‘, error);<br>}</p>
<p>navigator.getUserMedia(constraints, successCallback, errorCallback);<br> */<br></script></p>
</html>
备注：https://showmecode.jd.com/hr
(https://coding.jd.com/geek-team/geek-serve.git)
九、WebRTC服务提供商:
国外:
https://xirsys.com
https://tokbox.com/developer/
https://cloud.aculab.com/documents/webrtcdemo
https://www.twilio.com/webrtc
http://www.frafos.com/webrtc/
http://www.sightcall.com/
国内:
声网：https://www.agora.io/cn/
融云：http://www.rongcloud.cn/
亲加云：http://www.gotye.com.cn/
环信：https://www.easemob.com/
野狗通信云：https://www.wilddog.com/

<p>十、参考资料<br> <a target="_blank" rel="noopener" href="https://webrtc.org/">https://webrtc.org/</a><br><a target="_blank" rel="noopener" href="https://www.w3.org/TR/webrtc/">https://www.w3.org/TR/webrtc/</a><br><a target="_blank" rel="noopener" href="https://github.com/bovinphang/WebRT">https://github.com/bovinphang/WebRT</a><br><a target="_blank" rel="noopener" href="https://github.com/Tinywan/WebRTC-tutorial">https://github.com/Tinywan/WebRTC-tutorial</a>
  </p>

      
    </div>

    
      
         <div>    
          
          <ul class="post-copyright">
             <li class="post-copyright-link">
              <strong>本文作者：</strong>
              <a href="/" title="欢迎访问  的个人博客"></a>
            </li>

            <li class="post-copyright-link">
              <strong>本文标题：</strong>
              <a href="https://lvyong.github.io/2021/04/15/webRTC/" title="webRTC">webRTC</a>
            </li>

            <li class="post-copyright-link">
              <strong>本文链接：</strong>
              <a href="https://lvyong.github.io/2021/04/15/webRTC/" title="webRTC">https://lvyong.github.io/2021/04/15/webRTC/</a>
            </li>

            <li class="post-copyright-date">
                <strong>发布时间： </strong>
                2021年4月15日 - 20时04分
            </li>  

            <li class="post-copyright-license">
              <strong>版权声明： </strong>
              本文由  原创，采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="license" target="_blank">保留署名-非商业性使用-禁止演绎 4.0-国际许可协议</a> </br>转载请保留以上声明信息！
            </li>
          </ul>
        
      </div>
      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/%E6%8A%80%E6%9C%AF%E9%98%85%E8%AF%BB/">技术阅读</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2020/11/24/mysql-use-md/">
        <span class="next-text nav-default">mysql_use.md</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:lvg2010@126.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Lv YongGang</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
